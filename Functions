CREATE FUNCTION dbo.fn_Branza
(
    @ObszarKadrowy NVARCHAR(255)
)
RETURNS NVARCHAR(50)
AS
BEGIN
    DECLARE @result NVARCHAR(50);
    DECLARE @val    NVARCHAR(255);

    -- 1. Obetnij spacje i zamień pusty string na NULL
    SET @val = NULLIF(LTRIM(RTRIM(@ObszarKadrowy)), N'');

    IF @val IS NULL
    BEGIN
        -- nic nie podano / same spacje
        SET @result = NULL;      -- albo np. N'Brak danych'
        RETURN @result;
    END;

    -- 2. Ujednolicenie wielkości liter
    SET @val = UPPER(@val);

    -- 3. Mapowanie branży
    SET @result =
        CASE 
            WHEN @val = N'CENTRALA'      THEN N'Centrala'
            WHEN @val = N'ID WARSZAWA'   THEN N'ID'
            WHEN @val = N'IG WARSZAWA'   THEN N'IG'
            WHEN @val IN (N'IM KRAKÓW', N'IM KRAKOW') THEN N'IM'
            WHEN @val = N'IN WARSZAWA'   THEN N'IN'
            WHEN @val = N'IO WARSZAWA'   THEN N'IO'
            WHEN @val = N'IR WARSZAWA'   THEN N'IR'
            ELSE NULL   -- albo np. N'Inna branża'
        END;

    RETURN @result;
END;
GO
